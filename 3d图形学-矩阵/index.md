# 矩阵


# ***矩阵***

*简单来说矩阵就是一个矩形的数字、符号或表达式数组。矩阵中每一项叫做矩阵的元素(Element)。下面是一个2×3矩阵的例子*

![](https://raw.githubusercontent.com/CuteCocoa/MyImage/main/2024/12/24-11-12-35-2024-12-24-11-12-33-image.png)

*矩阵可以通过(i, j)进行索引，i是行，j是列，这就是上面的矩阵叫做2×3矩阵的原因（3列2行，也叫做矩阵的维度(Dimension)）。这与你在索引2D图像时的(x, y)相反，获取4的索引是(2, 1)（第二行，第一列）（如果是图像索引应该是(1, 2)，先算列，再算行）*

# ***矩阵的加减***

## ***矩阵与标量的加减***

***注意，数学上是没有矩阵与标量相加减的运算的，但是很多线性代数的库都对它有支持（比如说我们用的GLM）。如果你使用过numpy的话，可以把它理解为[Broadcasting](https://numpy.org/doc/1.18/user/basics.broadcasting.html)。***

1. ***相加***
   
   ![](https://raw.githubusercontent.com/CuteCocoa/MyImage/main/2024/12/24-11-17-16-2024-12-24-11-17-14-image.png)

2. ***相减***
   
   ![](https://raw.githubusercontent.com/CuteCocoa/MyImage/main/2024/12/24-11-18-24-2024-12-24-11-18-21-image.png)

## ***矩阵与矩阵的加减***

*矩阵与矩阵之间的加减就是两个矩阵对应元素的加减运算，所以总体的规则和与标量运算是差不多的，只不过在相同索引下的元素才能进行运算。**这也就是说加法和减法只对同维度的矩阵才是有定义的。** 一个3×2矩阵和一个2×3矩阵（或一个3×3矩阵与4×4矩阵）是不能进行加减的*

1. ***相加***
   
   ![](https://raw.githubusercontent.com/CuteCocoa/MyImage/main/2024/12/24-11-23-33-2024-12-24-11-23-31-image.png)

2. *相减*
   
   ![](https://raw.githubusercontent.com/CuteCocoa/MyImage/main/2024/12/24-11-24-01-2024-12-24-11-23-59-image.png)

# ***矩阵的乘法***

## ***矩阵与标量的相乘***

*和矩阵与标量的加减一样，矩阵与标量之间的乘法也是矩阵的每一个元素分别乘以该标量*

![](https://raw.githubusercontent.com/CuteCocoa/MyImage/main/2024/12/24-11-26-01-2024-12-24-11-25-58-image.png)

## ***矩阵与矩阵的相乘***

### ***相乘的一些限制***

1. ***只有当左侧矩阵的列数与右侧矩阵的行数相等，两个矩阵才能相乘。***

2. ***矩阵相乘不遵守交换律(Commutative)，也就是说A⋅B≠B⋅A。***

### ***相乘步骤***

*我们首先把左侧矩阵的行和右侧矩阵的列拿出来。这些挑出来行和列将决定我们该计算结果2x2矩阵的哪个输出值。如果取的是左矩阵的第一行，输出值就会出现在结果矩阵的第一行。接下来再取一列，如果我们取的是右矩阵的第一列，最终值则会出现在结果矩阵的第一列。这正是红框里的情况。如果想计算结果矩阵右下角的值，我们要用第一个矩阵的第二行和第二个矩阵的第二列（译注：简单来说就是结果矩阵的元素的行取决于第一个矩阵，列取决于第二个矩阵）*

![](https://raw.githubusercontent.com/CuteCocoa/MyImage/main/2024/12/24-12-58-03-2024-12-24-12-55-12-image.png)

*举一个更大的矩形例子 方便梳理*

![](https://raw.githubusercontent.com/CuteCocoa/MyImage/main/2024/12/24-12-58-08-2024-12-24-12-58-01-image.png)

## ***矩形与向量的相乘***

*向量，它其实就是一个 **N×1**矩阵，N表示向量分量的个数（也叫N维(N-dimensional)向量）。如果你仔细思考一下就会明白。向量和矩阵一样都是一个数字序列，但它只有1列。那么，这个新的定义对我们有什么帮助呢？如果我们有一个**M×N**矩阵，我们可以用这个矩阵乘以我们的**N×1**向量，因为这个矩阵的列数等于向量的行数，所以它们就能相乘*

*很多有趣的2D/3D变换都可以放在一个矩阵中，用这个矩阵乘以我们的向量将**变换**(Transform)这个向量*

# ***单位矩阵***

*在OpenGL中，由于某些原因我们通常使用 **4×4**的变换矩阵，而其中最重要的原因就是大部分的向量都是4分量的。我们能想到的最简单的变换矩阵就是单位矩阵(Identity Matrix)。*

*单位矩阵是一个除了对角线以外都是0的 **N×N**矩阵*

![](C:\Users\peng.xu\AppData\Roaming\marktext\images\2024-12-24-13-14-24-image.png)

## ***作用***

*单位矩阵通常是生成其他变换矩阵的起点，如果我们深挖线性代数，这还是一个对证明定理、解线性方程非常有用的矩阵。*

# ***缩放矩阵***

*构造一个变换矩阵来为我们提供缩放功能。我们从单位矩阵了解到，每个对角线元素会分别与向量的对应元素相乘。如果我们把1变为3会怎样？这样子的话，我们就把向量的每个元素乘以3了，这事实上就把向量缩放3倍。如果我们把缩放变量表示为(S1,S2,S3)我们可以为任意向量(x,y,z)定义一个缩放矩阵*

![](https://raw.githubusercontent.com/CuteCocoa/MyImage/main/2024/12/24-13-36-46-2024-12-24-13-36-43-image.png)

# ***位移矩阵***

*和缩放矩阵一样，在4×4矩阵上有几个特别的位置用来执行特定的操作，对于位移来说它们是第四列最上面的3个值。如果我们把位移向量表示为(Tx,Ty,Tz)，我们就能把位移矩阵定义为：*

![](https://raw.githubusercontent.com/CuteCocoa/MyImage/main/2024/12/24-13-45-12-2024-12-24-13-45-09-image.png)

*这样是能工作的，因为所有的位移值都要乘以向量的**w**行，所以位移值会加到向量的原始值上（想想矩阵乘法法则）。而如果你用3x3矩阵我们的位移值就没地方放也没地方乘了，所以是不行的*

# ***旋转矩阵***

*旋转矩阵在 3D空间中每个单位轴都有不同定义，旋转角度用 θ表示*

![](https://raw.githubusercontent.com/CuteCocoa/MyImage/main/2024/12/24-13-46-20-2024-12-24-13-46-18-image.png)

*利用旋转矩阵我们可以把任意位置向量沿一个单位旋转轴进行旋转。也可以将多个矩阵复合，比如先沿着x轴旋转再沿着y轴旋转。但是这会很快导致一个问题——万向节死锁（Gimbal Lock，可以看看[这个视频](https://www.youtube.com/watch?v=zc8b2Jo7mno)[（优酷）](http://v.youku.com/v_show/id_XNzkyOTIyMTI=.html)来了解）。在这里我们不会讨论它的细节，但是对于3D空间中的旋转，一个更好的模型是沿着任意的一个轴，比如单位向量$(0.662, 0.2, 0.7222)$旋转，而不是对一系列旋转矩阵进行复合。这样的一个（超级麻烦的）矩阵是存在的，见下面这个公式，其中(Rx,Ry,Rz)代表任意旋转轴：*

![](https://raw.githubusercontent.com/CuteCocoa/MyImage/main/2024/12/24-13-47-53-2024-12-24-13-47-51-image.png)

*在数学上讨论如何生成这样的矩阵仍然超出了本节内容。但是记住，即使这样一个矩阵也不能完全解决万向节死锁问题（尽管会极大地避免）。避免万向节死锁的真正解决方案是使用四元数(Quaternion)，它不仅更安全，而且计算会更有效率。*

# ***矩阵的组合***

*使用矩阵进行变换的真正力量在于，根据矩阵之间的乘法，我们可以把多个变换组合到一个矩阵中。让我们看看我们是否能生成一个变换矩阵，让它组合多个变换。假设我们有一个顶点(x, y, z)，我们希望将其缩放2倍，然后位移(1, 2, 3)个单位。我们需要一个位移和缩放矩阵来完成这些变换。结果的变换矩阵看起来像这样：*

![](https://raw.githubusercontent.com/CuteCocoa/MyImage/main/2024/12/24-13-50-39-2024-12-24-13-50-36-image.png)

*注意，当矩阵相乘时我们先写位移再写缩放变换的。矩阵乘法是不遵守交换律的，这意味着它们的顺序很重要。当矩阵相乘时，在最右边的矩阵是第一个与向量相乘的，所以你应该从右向左读这个乘法。建议您在组合矩阵时，先进行缩放操作，然后是旋转，最后才是位移，否则它们会（消极地）互相影响。比如，如果你先位移再缩放，位移的向量也会同样被缩放（译注：比如向某方向移动2米，2米也许会被缩放成1米）！*

*用最终的变换矩阵左乘我们的向量会得到以下结果：*

![](https://raw.githubusercontent.com/CuteCocoa/MyImage/main/2024/12/24-13-51-10-2024-12-24-13-51-08-image.png)

*不错！向量先缩放2倍，然后位移了(1, 2, 3)个单位。*

